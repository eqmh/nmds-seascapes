---
title: "Seascape NMDS"
output: html_notebook
---

This Rmd reads data table containing taxa densities collected during IMARPE fisheries surveys (Peru) and seascape class identified at each sampled site from monthly and 8-day seascapes at 4km pixel. NMDS plots are created with these data to evaluate seascape affinity by taxonomic groups. These tables are generated by the Matlab routine 'imarpe_survey.m'. 

NMDS is generated using code at https://jkzorz.github.io/2019/06/06/NMDS.html

```{r}
library(vegan)
library(dplyr)
library(ggplot2)
library(reshape2)
library(RColorBrewer)
```


```{r}

# reads the tables and transforms the last two columns to characters 
df_month <- read.csv("taxa_table_month.csv", header= TRUE)
df_month[52:53] <- lapply(df_month[52:53], as.character)
df_8d <- read.csv("taxa_table_8d.csv", header= TRUE)
df_8d[52:53] <- lapply(df_8d[52:53], as.character)

# first data visualization
df_mo_long <- df_month
df_mo_long <- melt(df_mo_long, id.vars=c("sample", "seascape"))
df_8d_long <- df_8d
df_8d_long <- melt(df_8d_long, id.vars=c("sample", "seascape"))

nb.cols <- 51
mycolors <- colorRampPalette(brewer.pal(8, "Spectral"))(nb.cols)
ggplot(df_mo_long, aes(fill=variable, y=value, x=seascape)) + 
    geom_bar(position="stack", stat="identity") +
    scale_fill_manual(values = mycolors) +
    labs(title = "Monthly seascapes (August 2017)")

ggplot(df_8d_long, aes(fill=variable, y=value, x=seascape)) + 
    geom_bar(position="stack", stat="identity") +
    scale_fill_manual(values = mycolors) +
    labs(title = "8-day seascapes (Aug-Sep 2017)")

```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.
```{r}
# removes rows with all zeros 
df_month <- df_month[!apply(df_month[, 1:51]==0, 1, all),]
df_8d <- df_8d[!apply(df_8d[, 1:51]==0, 1, all),]

## run the metaMDS command from the vegan package to generate an NMDS plot.
set.seed(123)
nmds_month = metaMDS(df_month[, 1:51], distance = "bray")
nmds_month

nmds_8d = metaMDS(df_8d[, 1:51], distance = "bray")
nmds_8d

plot(nmds_month)
plot(nmds_8d)

#extract NMDS scores (x and y coordinates)
data.scores_month = as.data.frame(scores(nmds_month))
data.scores_8d = as.data.frame(scores(nmds_8d))

#add columns to data frame 
data.scores_month$seascape = df_month$seascape
head(data.scores_month)
data.scores_8d$seascape = df_8d$seascape
head(data.scores_8d)

```

```{r}
xx_month = ggplot(data.scores_month, aes(x = NMDS1, y = NMDS2)) + 
    geom_point(size = 4, aes( colour = seascape))+ 
    theme(axis.text.y = element_text(colour = "black", size = 12, face = "bold"), 
    axis.text.x = element_text(colour = "black", face = "bold", size = 12), 
    legend.text = element_text(size = 12, face ="bold", colour ="black"), 
    legend.position = "right", axis.title.y = element_text(face = "bold", size = 14), 
    axis.title.x = element_text(face = "bold", size = 14, colour = "black"), 
    legend.title = element_text(size = 14, colour = "black", face = "bold"), 
    panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, size = 1.2)) 
xx_month
    
#ggsave("NMDS.svg")

xx_8d = ggplot(data.scores_8d, aes(x = NMDS1, y = NMDS2)) + 
    geom_point(size = 4, aes( colour = seascape))+ 
    theme(axis.text.y = element_text(colour = "black", size = 12, face = "bold"), 
    axis.text.x = element_text(colour = "black", face = "bold", size = 12), 
    legend.text = element_text(size = 12, face ="bold", colour ="black"), 
    legend.position = "right", axis.title.y = element_text(face = "bold", size = 14), 
    axis.title.x = element_text(face = "bold", size = 14, colour = "black"), 
    legend.title = element_text(size = 14, colour = "black", face = "bold"), 
    panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, size = 1.2)) 
xx_8d

#ggsave("NMDS.svg")
```

